<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galaxy Blaster</title>
  <style>
    :root { --bg:#000; --fg:#e8e8f0; --accent:#56ccf2; --muted:#9aa0a6; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    #wrap { display: grid; place-items: center; height: 100%; padding: 12px; }
    canvas { width: 100%; max-width: 960px; height: auto; aspect-ratio: 16/9; border: 1px solid #111; background: #000; display: block; }
    .hud { position: fixed; inset: 12px auto auto 12px; font-weight: 600; text-shadow: 0 1px 2px #000; }
    .hud span { margin-right: 16px; }
    .help { position: fixed; right: 12px; bottom: 12px; font-size: 12px; color: var(--muted); background: rgba(0,0,0,.35); padding: 6px 8px; border-radius: 6px; }
    .centerOverlay {
      position: fixed; inset: 0; display: none; place-items: center;
      background: rgba(0,0,0,0.6); text-align: center; padding: 20px;
    }
    .centerOverlay.active { display: grid; }
    .panel {
      background: #0b0b12; border: 1px solid #1b1b26; border-radius: 12px;
      padding: 20px; max-width: 560px; width: 92%;
      box-shadow: 0 8px 30px rgba(0,0,0,.5);
    }
    .panel h1 { margin: 0 0 10px; font-size: 28px; }
    .btn {
      display: inline-block; padding: 10px 16px; border-radius: 10px; cursor: pointer;
      background: var(--accent); color: #061018; font-weight: 800; border: 0; margin-top: 10px;
    }
    a { color: var(--accent); }
  </style>
</head>
<body>
  <div class="hud">
    <span id="score">Score: 0</span>
    <span id="lives">Lives: 3</span>
  </div>
  <div id="wrap">
    <canvas id="game" width="960" height="540"></canvas>
  </div>
  <div class="help">Move: WASD / Arrows • Shoot: Space • Pause: P</div>

  <div id="overlay" class="centerOverlay active">
    <div class="panel">
      <h1>Galaxy Blaster</h1>
      <p>Blast enemies and dodge meteors. Collect points and survive!</p>
      <p><strong>Controls:</strong> WASD / Arrows to move, Space to shoot, P to pause.</p>
      <button id="startBtn" class="btn">Start</button>
    </div>
  </div>

  <script>
    // ---- Update these if your filenames differ ----
    const ASSET_PATHS = {
      background: "/Backgrounds/black.png",
      player: "/playerShip1_blue.png",
      enemy: "/Enemies/enemyRed3.png",
      meteor: "/Meteors/meteorBrown_big1.png",
      bullet: "/Lasers/laserBlue06.png"
    };
    // ----------------------------------------------

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const W = canvas.width, H = canvas.height;

    // HUD
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");

    // Input
    const keys = {};
    addEventListener("keydown", (e)=>{ keys[e.key.toLowerCase()] = true; if ([" ", "arrowup", "arrowdown", "arrowleft", "arrowright"].includes(e.key.toLowerCase())) e.preventDefault(); });
    addEventListener("keyup",   (e)=>{ keys[e.key.toLowerCase()] = false; });

    // Images
    function loadImage(src) { return new Promise((res, rej)=>{ const i = new Image(); i.onload = ()=>res(i); i.onerror = rej; i.src = src; }); }
    const assets = {};

    // Entities
    class Entity {
      constructor(x,y,w,h,img) { this.x=x; this.y=y; this.w=w; this.h=h; this.img=img; this.dx=0; this.dy=0; this.dead=false; }
      rect(){ return {x:this.x, y:this.y, w:this.w, h:this.h}; }
      draw(){ ctx.drawImage(this.img, this.x, this.y, this.w, this.h); }
    }
    class Bullet extends Entity {
      constructor(x,y){ super(x,y,16,32,assets.bullet); this.dy = -8; }
      update(){ this.y += this.dy; if(this.y + this.h < 0) this.dead = true; }
    }
    class Enemy extends Entity {
      constructor(x,y){ super(x,y,56,56,assets.enemy); this.dy = 1.8 + Math.random()*1.2; this.dx = (Math.random() * 2 - 1) * 0.8; }
      update(){ this.x += this.dx; this.y += this.dy; if(this.y > H + 60) this.dead = true; if(this.x<0||this.x+this.w>W) this.dx *= -1; }
    }
    class Meteor extends Entity {
      constructor(x,y){ super(x,y,64,64,assets.meteor); this.dy = 2.4 + Math.random()*1.4; this.dx = (Math.random()*2-1)*1.4; this.angle = 0; this.spin = (Math.random()*0.05)+0.01; }
      update(){ this.x += this.dx; this.y += this.dy; this.angle += this.spin; if(this.y > H + 80) this.dead = true; }
      draw(){
        ctx.save();
        ctx.translate(this.x + this.w/2, this.y + this.h/2);
        ctx.rotate(this.angle);
        ctx.drawImage(this.img, -this.w/2, -this.h/2, this.w, this.h);
        ctx.restore();
      }
    }

    // Player
    const player = {
      x: W/2-28, y: H-110, w: 56, h: 56, speed: 4, img: null, cooldown: 0, lives: 3, inv: 0
    };
    let bullets = [];
    let enemies = [];
    let meteors = [];
    let bgScroll = 0;
    let score = 0;
    let paused = false;
    let running = false;

    function aabb(a,b){
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function spawnEnemies(){
      if (Math.random() < 0.03) {
        const x = Math.random()*(W-60);
        enemies.push(new Enemy(x, -70));
      }
    }
    function spawnMeteors(){
      if (Math.random() < 0.02) {
        const x = Math.random()*(W-70);
        meteors.push(new Meteor(x, -90));
      }
    }

    function update(){
      if (!running || paused) return;

      // Background scroll
      bgScroll += 1.2;
      if (bgScroll >= H) bgScroll = 0;

      // Player movement
      const left = keys["arrowleft"] || keys["a"];
      const right = keys["arrowright"] || keys["d"];
      const up = keys["arrowup"] || keys["w"];
      const down = keys["arrowdown"] || keys["s"];
      const shoot = keys[" "];

      if (left)  player.x -= player.speed;
      if (right) player.x += player.speed;
      if (up)    player.y -= player.speed;
      if (down)  player.y += player.speed;
      player.x = Math.max(0, Math.min(W-player.w, player.x));
      player.y = Math.max(0, Math.min(H-player.h, player.y));

      // Shooting
      if (player.cooldown > 0) player.cooldown--;
      if (shoot && player.cooldown <= 0) {
        bullets.push(new Bullet(player.x + player.w/2 - 8, player.y - 24));
        player.cooldown = 10;
      }

      // Spawners
      spawnEnemies();
      spawnMeteors();

      // Update entities
      bullets.forEach(b=>b.update());
      enemies.forEach(e=>e.update());
      meteors.forEach(m=>m.update());

      // Collisions: bullets -> enemies/meteors
      bullets.forEach(b=>{
        enemies.forEach(e=>{
          if(!b.dead && !e.dead && aabb(b.rect(), e.rect())) { b.dead = true; e.dead = true; score += 50; }
        });
        meteors.forEach(m=>{
          if(!b.dead && !m.dead && aabb(b.rect(), m.rect())) { b.dead = true; m.dead = true; score += 25; }
        });
      });

      // Collisions: player -> enemies/meteors
      if (player.inv > 0) player.inv--;
      enemies.forEach(e=>{
        if(!e.dead && player.inv<=0 && aabb(player, e.rect())) { e.dead=true; damage(); }
      });
      meteors.forEach(m=>{
        if(!m.dead && player.inv<=0 && aabb(player, m.rect())) { m.dead=true; damage(); }
      });

      // Cleanup
      bullets = bullets.filter(b=>!b.dead);
      enemies = enemies.filter(e=>!e.dead);
      meteors = meteors.filter(m=>!m.dead);

      // HUD
      scoreEl.textContent = "Score: " + score;
      livesEl.textContent = "Lives: " + player.lives;

      // Draw
      draw();

      requestAnimationFrame(update);
    }

    function draw(){
      // Tiled scrolling background
      const bg = assets.background;
      const tilesX = Math.ceil(W / bg.width) + 1;
      const tilesY = Math.ceil(H / bg.height) + 1;
      for (let y = -1; y < tilesY; y++){
        for (let x = -1; x < tilesX; x++){
          ctx.drawImage(bg, x * bg.width, (y * bg.height) + (bgScroll % bg.height));
        }
      }

      // Entities
      bullets.forEach(b=>b.draw());
      enemies.forEach(e=>e.draw());
      meteors.forEach(m=>m.draw());

      // Player (blink when invulnerable)
      if (player.inv % 6 < 4) {
        ctx.drawImage(player.img, player.x, player.y, player.w, player.h);
      }
    }

    function damage(){
      player.lives--;
      player.inv = 90; // ~1.5s of invulnerability
      if (player.lives <= 0) gameOver();
    }

    function gameOver(){
      running = false;
      overlay.classList.add("active");
      overlay.querySelector(".panel").innerHTML = `
        <h1>Game Over</h1>
        <p>Your score: <strong>${score}</strong></p>
        <button id="restartBtn" class="btn">Play Again</button>
        <p style="margin-top:10px"><small>Tip: You can adjust asset paths at the top of <code>index.html</code>.</small></p>
      `;
      overlay.querySelector("#restartBtn").addEventListener("click", startGame);
    }

    function startGame(){
      // Reset state
      bullets = [];
      enemies = [];
      meteors = [];
      player.x = W/2-28; player.y = H-110; player.lives = 3; player.inv = 0; player.cooldown=0;
      score = 0; paused = false; running = true;
      overlay.classList.remove("active");
      requestAnimationFrame(update);
    }

    // Pause toggle
    addEventListener("keydown", (e)=>{
      if (e.key.toLowerCase() === "p" && running) {
        paused = !paused;
        if (!paused) requestAnimationFrame(update);
      }
    });

    // Boot
    (async function(){
      try {
        // Load assets
        const [bg, playerImg, enemyImg, meteorImg, bulletImg] = await Promise.all([
          loadImage(ASSET_PATHS.background),
          loadImage(ASSET_PATHS.player),
          loadImage(ASSET_PATHS.enemy),
          loadImage(ASSET_PATHS.meteor),
          loadImage(ASSET_PATHS.bullet),
        ]);
        assets.background = bg;
        assets.enemy = enemyImg;
        assets.meteor = meteorImg;
        assets.bullet = bulletImg;
        player.img = playerImg;

        // Ready UI
        startBtn.addEventListener("click", startGame);
      } catch (err) {
        console.error("Asset load error:", err);
        overlay.classList.add("active");
        overlay.querySelector(".panel").innerHTML = `
          <h1>Asset Load Error</h1>
          <p>Make sure these files exist (paths are from project root):</p>
          <ul style="text-align:left">
            <li>${ASSET_PATHS.background}</li>
            <li>${ASSET_PATHS.player}</li>
            <li>${ASSET_PATHS.enemy}</li>
            <li>${ASSET_PATHS.meteor}</li>
            <li>${ASSET_PATHS.bullet}</li>
          </ul>
          <button id="retryBtn" class="btn">Retry</button>
        `;
        document.getElementById("retryBtn").addEventListener("click", ()=>location.reload());
      }
    })();
  </script>
</body>
</html>
